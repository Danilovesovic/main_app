<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="/bootstrap.css">
    <link rel="stylesheet" href="/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/admin/main.css">
</head>
<body>
<%- include('../partials/navbar.ejs', { user: user })%>
<div class="container-fluid mt-5">
    <div class="row">
        <%- include('../partials/sidebar.ejs', {title: "Superadmin"})%>
        <div class="col-10">
            <div class="d-flex align-items-center mb-3">
                <h1>Superadmin</h1>
                <a href="/admin/superadmin/create" class="btn btn-outline-primary ms-auto">New User</a>
            </div>
            <hr>
            <div class="row">
                <div class="col-10 offset-1">
                    <table class="table">
                        <thead>
                        <tr>
                            <th>User</th>
                            <th>Co-superadmin</th>
                            <th>Flag</th>
                            <th>Delete</th>
                        </tr>
                        </thead>
                        <tbody>
                        <% users.forEach(function(user){ %>
                            <tr>
                                <td><%= user.username%></td>
                                <td>
                                    <%= user.role || '' %>
                                </td>
                                <td>
                                    <%= user.flag || '' %>
                                </td>
                                <td>
                                    <i data-id="<%= user._id %>"class="superadmin-delete-btns bi-trash"></i>  
                                </td>
                               
                            </tr>
                        <% }) %>

                        </tbody>
                    </table>
                </div>
            </div>



<script src="/jquery.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
<script>
   
   let deleteBtns = document.querySelectorAll('.superadmin-delete-btns');
   deleteBtns.forEach(btn => {
      btn.addEventListener('click', deleteUser)
   })

   function deleteUser(e){
       let id = e.target.getAttribute('data-id');
   
    // let id = e.target.dataset.id;

       if(!id) return alert('ID not found!');
       
       fetch(`/admin/superadmin/${id}`, {method: 'DELETE'})
           .then(res => { 
           if(!res.ok) throw new Error(`Server returned ${res.status}`);
            return res.json();
           })
           .then(data => {
               if(data.msg === 'User deleted successfully'){
                   location.reload();
               }else {
                alert('Something went wrong');
               }
           })
            .catch(err => console.error(err));
   }
 
</script>
</body>
</html>
